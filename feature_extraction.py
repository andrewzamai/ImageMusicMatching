#from keras.applications import VGG16
from tensorflow.keras.applications.vgg16 import VGG16
from tensorflow.keras.applications.vgg16 import preprocess_input
#from tensorflow.keras.preprocessing import image
#from tensorflow.keras.applications.vgg16.preprocess_input import preprocess_input
from posixpath import split
import numpy as np
import pandas as pd
from sklearn.decomposition import PCA
from os.path import exists



PATH = 'C:/Users/nikop/Desktop/universita/ArtificalIntelligence/features'
AUDIO_SHAPE = (87, 197, 3)
model = VGG16(
    include_top = False,
    input_shape = AUDIO_SHAPE,
    weights = "imagenet",
)

pca_frame = PCA(n_components=87)
pca_features = PCA(n_components=197)


for tmp_track in range(2, 2058):
    track = str(tmp_track)
    track_path = PATH + '/' + track + '.csv'
    if (exists(track_path)):
        df = pd.read_csv(track_path)
        data = []
        features = df['frameTime;F0final_sma_stddev;F0final_sma_amean;voicingFinalUnclipped_sma_stddev;voicingFinalUnclipped_sma_amean;jitterLocal_sma_stddev;jitterLocal_sma_amean;jitterDDP_sma_stddev;jitterDDP_sma_amean;shimmerLocal_sma_stddev;shimmerLocal_sma_amean;logHNR_sma_stddev;logHNR_sma_amean;audspec_lengthL1norm_sma_stddev;audspec_lengthL1norm_sma_amean;audspecRasta_lengthL1norm_sma_stddev;audspecRasta_lengthL1norm_sma_amean;pcm_RMSenergy_sma_stddev;pcm_RMSenergy_sma_amean;pcm_zcr_sma_stddev;pcm_zcr_sma_amean;audSpec_Rfilt_sma[0]_stddev;audSpec_Rfilt_sma[0]_amean;audSpec_Rfilt_sma[1]_stddev;audSpec_Rfilt_sma[1]_amean;audSpec_Rfilt_sma[2]_stddev;audSpec_Rfilt_sma[2]_amean;audSpec_Rfilt_sma[3]_stddev;audSpec_Rfilt_sma[3]_amean;audSpec_Rfilt_sma[4]_stddev;audSpec_Rfilt_sma[4]_amean;audSpec_Rfilt_sma[5]_stddev;audSpec_Rfilt_sma[5]_amean;audSpec_Rfilt_sma[6]_stddev;audSpec_Rfilt_sma[6]_amean;audSpec_Rfilt_sma[7]_stddev;audSpec_Rfilt_sma[7]_amean;audSpec_Rfilt_sma[8]_stddev;audSpec_Rfilt_sma[8]_amean;audSpec_Rfilt_sma[9]_stddev;audSpec_Rfilt_sma[9]_amean;audSpec_Rfilt_sma[10]_stddev;audSpec_Rfilt_sma[10]_amean;audSpec_Rfilt_sma[11]_stddev;audSpec_Rfilt_sma[11]_amean;audSpec_Rfilt_sma[12]_stddev;audSpec_Rfilt_sma[12]_amean;audSpec_Rfilt_sma[13]_stddev;audSpec_Rfilt_sma[13]_amean;audSpec_Rfilt_sma[14]_stddev;audSpec_Rfilt_sma[14]_amean;audSpec_Rfilt_sma[15]_stddev;audSpec_Rfilt_sma[15]_amean;audSpec_Rfilt_sma[16]_stddev;audSpec_Rfilt_sma[16]_amean;audSpec_Rfilt_sma[17]_stddev;audSpec_Rfilt_sma[17]_amean;audSpec_Rfilt_sma[18]_stddev;audSpec_Rfilt_sma[18]_amean;audSpec_Rfilt_sma[19]_stddev;audSpec_Rfilt_sma[19]_amean;audSpec_Rfilt_sma[20]_stddev;audSpec_Rfilt_sma[20]_amean;audSpec_Rfilt_sma[21]_stddev;audSpec_Rfilt_sma[21]_amean;audSpec_Rfilt_sma[22]_stddev;audSpec_Rfilt_sma[22]_amean;audSpec_Rfilt_sma[23]_stddev;audSpec_Rfilt_sma[23]_amean;audSpec_Rfilt_sma[24]_stddev;audSpec_Rfilt_sma[24]_amean;audSpec_Rfilt_sma[25]_stddev;audSpec_Rfilt_sma[25]_amean;pcm_fftMag_fband250-650_sma_stddev;pcm_fftMag_fband250-650_sma_amean;pcm_fftMag_fband1000-4000_sma_stddev;pcm_fftMag_fband1000-4000_sma_amean;pcm_fftMag_spectralRollOff25.0_sma_stddev;pcm_fftMag_spectralRollOff25.0_sma_amean;pcm_fftMag_spectralRollOff50.0_sma_stddev;pcm_fftMag_spectralRollOff50.0_sma_amean;pcm_fftMag_spectralRollOff75.0_sma_stddev;pcm_fftMag_spectralRollOff75.0_sma_amean;pcm_fftMag_spectralRollOff90.0_sma_stddev;pcm_fftMag_spectralRollOff90.0_sma_amean;pcm_fftMag_spectralFlux_sma_stddev;pcm_fftMag_spectralFlux_sma_amean;pcm_fftMag_spectralCentroid_sma_stddev;pcm_fftMag_spectralCentroid_sma_amean;pcm_fftMag_spectralEntropy_sma_stddev;pcm_fftMag_spectralEntropy_sma_amean;pcm_fftMag_spectralVariance_sma_stddev;pcm_fftMag_spectralVariance_sma_amean;pcm_fftMag_spectralSkewness_sma_stddev;pcm_fftMag_spectralSkewness_sma_amean;pcm_fftMag_spectralKurtosis_sma_stddev;pcm_fftMag_spectralKurtosis_sma_amean;pcm_fftMag_spectralSlope_sma_stddev;pcm_fftMag_spectralSlope_sma_amean;pcm_fftMag_psySharpness_sma_stddev;pcm_fftMag_psySharpness_sma_amean;pcm_fftMag_spectralHarmonicity_sma_stddev;pcm_fftMag_spectralHarmonicity_sma_amean;pcm_fftMag_mfcc_sma[1]_stddev;pcm_fftMag_mfcc_sma[1]_amean;pcm_fftMag_mfcc_sma[2]_stddev;pcm_fftMag_mfcc_sma[2]_amean;pcm_fftMag_mfcc_sma[3]_stddev;pcm_fftMag_mfcc_sma[3]_amean;pcm_fftMag_mfcc_sma[4]_stddev;pcm_fftMag_mfcc_sma[4]_amean;pcm_fftMag_mfcc_sma[5]_stddev;pcm_fftMag_mfcc_sma[5]_amean;pcm_fftMag_mfcc_sma[6]_stddev;pcm_fftMag_mfcc_sma[6]_amean;pcm_fftMag_mfcc_sma[7]_stddev;pcm_fftMag_mfcc_sma[7]_amean;pcm_fftMag_mfcc_sma[8]_stddev;pcm_fftMag_mfcc_sma[8]_amean;pcm_fftMag_mfcc_sma[9]_stddev;pcm_fftMag_mfcc_sma[9]_amean;pcm_fftMag_mfcc_sma[10]_stddev;pcm_fftMag_mfcc_sma[10]_amean;pcm_fftMag_mfcc_sma[11]_stddev;pcm_fftMag_mfcc_sma[11]_amean;pcm_fftMag_mfcc_sma[12]_stddev;pcm_fftMag_mfcc_sma[12]_amean;pcm_fftMag_mfcc_sma[13]_stddev;pcm_fftMag_mfcc_sma[13]_amean;pcm_fftMag_mfcc_sma[14]_stddev;pcm_fftMag_mfcc_sma[14]_amean;F0final_sma_de_stddev;F0final_sma_de_amean;voicingFinalUnclipped_sma_de_stddev;voicingFinalUnclipped_sma_de_amean;jitterLocal_sma_de_stddev;jitterLocal_sma_de_amean;jitterDDP_sma_de_stddev;jitterDDP_sma_de_amean;shimmerLocal_sma_de_stddev;shimmerLocal_sma_de_amean;logHNR_sma_de_stddev;logHNR_sma_de_amean;audspec_lengthL1norm_sma_de_stddev;audspec_lengthL1norm_sma_de_amean;audspecRasta_lengthL1norm_sma_de_stddev;audspecRasta_lengthL1norm_sma_de_amean;pcm_RMSenergy_sma_de_stddev;pcm_RMSenergy_sma_de_amean;pcm_zcr_sma_de_stddev;pcm_zcr_sma_de_amean;audSpec_Rfilt_sma_de[0]_stddev;audSpec_Rfilt_sma_de[0]_amean;audSpec_Rfilt_sma_de[1]_stddev;audSpec_Rfilt_sma_de[1]_amean;audSpec_Rfilt_sma_de[2]_stddev;audSpec_Rfilt_sma_de[2]_amean;audSpec_Rfilt_sma_de[3]_stddev;audSpec_Rfilt_sma_de[3]_amean;audSpec_Rfilt_sma_de[4]_stddev;audSpec_Rfilt_sma_de[4]_amean;audSpec_Rfilt_sma_de[5]_stddev;audSpec_Rfilt_sma_de[5]_amean;audSpec_Rfilt_sma_de[6]_stddev;audSpec_Rfilt_sma_de[6]_amean;audSpec_Rfilt_sma_de[7]_stddev;audSpec_Rfilt_sma_de[7]_amean;audSpec_Rfilt_sma_de[8]_stddev;audSpec_Rfilt_sma_de[8]_amean;audSpec_Rfilt_sma_de[9]_stddev;audSpec_Rfilt_sma_de[9]_amean;audSpec_Rfilt_sma_de[10]_stddev;audSpec_Rfilt_sma_de[10]_amean;audSpec_Rfilt_sma_de[11]_stddev;audSpec_Rfilt_sma_de[11]_amean;audSpec_Rfilt_sma_de[12]_stddev;audSpec_Rfilt_sma_de[12]_amean;audSpec_Rfilt_sma_de[13]_stddev;audSpec_Rfilt_sma_de[13]_amean;audSpec_Rfilt_sma_de[14]_stddev;audSpec_Rfilt_sma_de[14]_amean;audSpec_Rfilt_sma_de[15]_stddev;audSpec_Rfilt_sma_de[15]_amean;audSpec_Rfilt_sma_de[16]_stddev;audSpec_Rfilt_sma_de[16]_amean;audSpec_Rfilt_sma_de[17]_stddev;audSpec_Rfilt_sma_de[17]_amean;audSpec_Rfilt_sma_de[18]_stddev;audSpec_Rfilt_sma_de[18]_amean;audSpec_Rfilt_sma_de[19]_stddev;audSpec_Rfilt_sma_de[19]_amean;audSpec_Rfilt_sma_de[20]_stddev;audSpec_Rfilt_sma_de[20]_amean;audSpec_Rfilt_sma_de[21]_stddev;audSpec_Rfilt_sma_de[21]_amean;audSpec_Rfilt_sma_de[22]_stddev;audSpec_Rfilt_sma_de[22]_amean;audSpec_Rfilt_sma_de[23]_stddev;audSpec_Rfilt_sma_de[23]_amean;audSpec_Rfilt_sma_de[24]_stddev;audSpec_Rfilt_sma_de[24]_amean;audSpec_Rfilt_sma_de[25]_stddev;audSpec_Rfilt_sma_de[25]_amean;pcm_fftMag_fband250-650_sma_de_stddev;pcm_fftMag_fband250-650_sma_de_amean;pcm_fftMag_fband1000-4000_sma_de_stddev;pcm_fftMag_fband1000-4000_sma_de_amean;pcm_fftMag_spectralRollOff25.0_sma_de_stddev;pcm_fftMag_spectralRollOff25.0_sma_de_amean;pcm_fftMag_spectralRollOff50.0_sma_de_stddev;pcm_fftMag_spectralRollOff50.0_sma_de_amean;pcm_fftMag_spectralRollOff75.0_sma_de_stddev;pcm_fftMag_spectralRollOff75.0_sma_de_amean;pcm_fftMag_spectralRollOff90.0_sma_de_stddev;pcm_fftMag_spectralRollOff90.0_sma_de_amean;pcm_fftMag_spectralFlux_sma_de_stddev;pcm_fftMag_spectralFlux_sma_de_amean;pcm_fftMag_spectralCentroid_sma_de_stddev;pcm_fftMag_spectralCentroid_sma_de_amean;pcm_fftMag_spectralEntropy_sma_de_stddev;pcm_fftMag_spectralEntropy_sma_de_amean;pcm_fftMag_spectralVariance_sma_de_stddev;pcm_fftMag_spectralVariance_sma_de_amean;pcm_fftMag_spectralSkewness_sma_de_stddev;pcm_fftMag_spectralSkewness_sma_de_amean;pcm_fftMag_spectralKurtosis_sma_de_stddev;pcm_fftMag_spectralKurtosis_sma_de_amean;pcm_fftMag_spectralSlope_sma_de_stddev;pcm_fftMag_spectralSlope_sma_de_amean;pcm_fftMag_psySharpness_sma_de_stddev;pcm_fftMag_psySharpness_sma_de_amean;pcm_fftMag_spectralHarmonicity_sma_de_stddev;pcm_fftMag_spectralHarmonicity_sma_de_amean;pcm_fftMag_mfcc_sma_de[1]_stddev;pcm_fftMag_mfcc_sma_de[1]_amean;pcm_fftMag_mfcc_sma_de[2]_stddev;pcm_fftMag_mfcc_sma_de[2]_amean;pcm_fftMag_mfcc_sma_de[3]_stddev;pcm_fftMag_mfcc_sma_de[3]_amean;pcm_fftMag_mfcc_sma_de[4]_stddev;pcm_fftMag_mfcc_sma_de[4]_amean;pcm_fftMag_mfcc_sma_de[5]_stddev;pcm_fftMag_mfcc_sma_de[5]_amean;pcm_fftMag_mfcc_sma_de[6]_stddev;pcm_fftMag_mfcc_sma_de[6]_amean;pcm_fftMag_mfcc_sma_de[7]_stddev;pcm_fftMag_mfcc_sma_de[7]_amean;pcm_fftMag_mfcc_sma_de[8]_stddev;pcm_fftMag_mfcc_sma_de[8]_amean;pcm_fftMag_mfcc_sma_de[9]_stddev;pcm_fftMag_mfcc_sma_de[9]_amean;pcm_fftMag_mfcc_sma_de[10]_stddev;pcm_fftMag_mfcc_sma_de[10]_amean;pcm_fftMag_mfcc_sma_de[11]_stddev;pcm_fftMag_mfcc_sma_de[11]_amean;pcm_fftMag_mfcc_sma_de[12]_stddev;pcm_fftMag_mfcc_sma_de[12]_amean;pcm_fftMag_mfcc_sma_de[13]_stddev;pcm_fftMag_mfcc_sma_de[13]_amean;pcm_fftMag_mfcc_sma_de[14]_stddev;pcm_fftMag_mfcc_sma_de[14]_amean']
        for f in features:
            feat = str(f)
            feat = feat.split(';')
            feat = feat[1:]
            data.append(feat)
        data = np.array(data)
        data = pca_features.fit(data).components_
        data = pca_frame.fit(data.T).components_
        x = np.stack((data,data,data), 2)
        x = np.reshape(x, (1, 87, 197, 3))
        features = model.predict(x)

            
